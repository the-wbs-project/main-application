<div class="pd-15">
  <!--<wbs-tree
    view="phase"
    [width]="width()"
    [nodes]="phases()"
    [project]="project()"
    [columns]="columns"
    [rowReorderable]="claims | check : canEditClaim"
    [expandedKeys]="phaseIds() ?? []"
    [menuItems]="[phases(), claims] | taskMenu : taskId"
    [isDraggable]="true"
    (actionClicked)="service.action($event, taskId!)"
    (reordered)="service.reordered($event)"
    (selectedChanged)="taskId = $event.id"
    (showDetails)="navigate.toTask($event)"
  />-->
  <div
    *ngIf="phases(); let phases"
    class="d-flex flex-column"
    appFillElement
    [paddingBottom]="30"
  >
    <div class="tx-italic tx-10">
      {{ "Projects.TreeInstructions" | translate }}
    </div>
    <div class="flex-fill">
      <kendo-treelist
        #treelist
        class="h-100 tx-12"
        kendoTreeListExpandable
        kendoTreeListSelectable
        [kendoTreeListFlatBinding]="phases"
        parentIdField="treeParentId"
        idField="treeId"
        [rowReorderable]="claims | check : canEditClaim"
        [initiallyExpanded]="false"
        [(expandedKeys)]="expandedKeys"
        [selectable]="settings"
        (selectionChange)="taskId = $event.items[0].dataItem"
        (rowReorder)="rowReordered($event)"
        (dblclick)="navigate.toTask(taskId!)"
        (cellClick)="taskId = $event.dataItem.id"
      >
        <!--<ng-template
          kendoTreeListToolbarTemplate
          *ngIf="[phases(), claims] | taskMenu : taskId; let menuItems"
        >
          <div class="d-ib pd-r-20" *ngFor="let menu of menuItems">
            <wbs-action-buttons
              [items]="menu"
              (clicked)="service.action($event, taskId!)"
            />
          </div>
        </ng-template>-->
        <kendo-treelist-rowreorder-column
          *ngIf="claims | check : canEditClaim"
          [width]="40"
        />
        <kendo-treelist-column
          field="levelText"
          [title]="'Wbs.Level' | translate"
          [width]="100"
          class="level-column tx-11"
          headerClass="level-header-column"
        />
        <kendo-treelist-column
          [expandable]="true"
          field="title"
          [title]="'Wbs.Task' | translate"
          class="tx-11"
        />
        <kendo-treelist-column [width]="175" [title]="'Approval'">
          <ng-template kendoTreeListCellTemplate let-dataItem>
            <div class="tx-12 w-100 d-flex flex-row flex-align-center">
              <wbs-approval-badge
                [fontSize]="8"
                [approval]="approvals()?.get(dataItem.id)"
              />
              <div
                *ngIf="
                  dataItem.childrenIds | childrenApproval : approvals();
                  let stats
                "
                class="d-ib wd-100 mg-l-10"
                [title]="stats.totalCount"
              >
                <wbs-progress-bar
                  [passPercent]="stats.passedPercent"
                  [failPercent]="stats.failedPercent"
                />
              </div>
            </div>
          </ng-template>
        </kendo-treelist-column>
        <kendo-treelist-column
          *ngIf="(width() ?? 0) > 800"
          field="disciplines"
          [width]="150"
          class="discipline-column"
          headerClass="discipline-column"
        >
          <ng-template kendoTreeListHeaderTemplate>
            <wbs-tree-discipline-legend
              [idsOrCats]="project()?.disciplines ?? []"
            />
          </ng-template>
          <ng-template kendoTreeListCellTemplate let-dataItem>
            <wbs-discipline-icon-list [disciplines]="dataItem.disciplines" />
          </ng-template>
        </kendo-treelist-column>
      </kendo-treelist>
    </div>
  </div>
</div>

<wbs-task-modal />
