@if (isLoading()) {
<div class="w-100 text-center mg-t-50">
  <fa-duotone-icon [icon]="faSpinner" size="5x" animation="spin" />
  <h3 class="pd-t-20">
    {{ "General.Loading" | translate }}
  </h3>
</div>
} @else {
<!-- hello world -->
@let tree = entryStore.viewModels() ?? []; @let editEnabled = canEdit(); @let
versionDisciplines = disciplines();
<div [(wbsTreeHeight)]="containerHeight" class="pd-15 d-flex flex-column h-100">
  @if (alert(); as alertText) {
  <wbs-alert
    type="danger"
    [message]="alertText"
    (closed)="alert.set(undefined)"
  />
  }
  <kendo-treelist
    #treelist
    class="tx-12"
    kendoTreeListExpandable
    kendoTreeListSelectable
    [kendoTreeListFlatBinding]="tree"
    parentIdField="treeParentId"
    idField="treeId"
    [rowHeight]="30"
    [pageSize]="100"
    [height]="containerHeight() - 50"
    scrollable="virtual"
    [rowReorderable]="true"
    [initiallyExpanded]="false"
    [(expandedKeys)]="treeService.expandedKeys"
    [navigable]="true"
    [selectable]="{ enabled: true, mode: 'row' }"
    [rowReorderable]="editEnabled"
    (selectionChange)="selectedTask.set($event.items[0].dataItem)"
    (rowReorder)="rowReordered($event)"
    (cellClick)="cellClick($event)"
    (dblclick)="navigateToTask(selectedTask()?.id)"
  >
    <ng-template kendoTreeListToolbarTemplate>
      @if (canCreate() && entryStore.entry()?.type === 'project') {
      <wbs-tree-buttons-add (click)="menuItemSelected('addSub')" />
      }
      <wbs-tree-buttons-toggler
        (collapse)="treeService.collapseAll(treelist, tree)"
        (expand)="treeService.expandAll(treelist, tree)"
      />
    </ng-template>
    @if (editEnabled) { <kendo-treelist-rowreorder-column [width]="40" /> }

    <kendo-treelist-column
      [expandable]="true"
      field="title"
      class="child-hoverer tree-column"
      headerClass="tx-14"
      [title]="'Wbs.Activity_Title' | translate"
    >
      <ng-template kendoTreeListCellTemplate let-dataItem>
        @if (editEnabled) {
        <wbs-task-title
          [canEdit]="true"
          [level]="dataItem.levelText"
          [title]="dataItem.title"
          (edit)="treeService.editTitle(treelist, dataItem)"
        />
        @if (treeService.getSaveState(dataItem.id); as saveState) {
        <wbs-save-message [state]="saveState()" cssClass=" mg-l-15 tx-12" />
        } } @else {
        {{ dataItem.levelText }} &nbsp;-&nbsp; {{ dataItem.title }}
        }
      </ng-template>
      <ng-template kendoTreeListEditTemplate let-dataItem="dataItem">
        <wbs-task-title-editor
          [title]="dataItem.title"
          (save)="taskTitleChanged(treelist, dataItem.id, $event)"
          (cancel)="treelist.closeCell()"
        />
      </ng-template>
    </kendo-treelist-column>

    @if ((width() ?? 0) > 600) {
    <kendo-treelist-column
      [width]="100"
      class="tree-column"
      headerClass="tx-14"
    >
      <ng-template kendoTreeListHeaderTemplate>
        <wbs-tree-flag-column-header />
      </ng-template>
      <ng-template kendoTreeListCellTemplate let-dataItem>
        @if (dataItem.visibility) {
        <wbs-visibility-icon [visibility]="dataItem.visibility" />
        }
      </ng-template>
    </kendo-treelist-column>
    } @if ((width() ?? 0) > 800) {

    <kendo-treelist-column
      [width]="200"
      field="disciplines"
      class="tree-column tx-13-f"
      headerClass="tx-14"
    >
      <ng-template kendoTreeListHeaderTemplate>
        <wbs-tree-discipline-legend [list]="versionDisciplines" />
      </ng-template>
      <ng-template kendoTreeListCellTemplate let-dataItem>
        <wbs-discipline-icon-list [items]="dataItem.disciplines" />
      </ng-template>
      <ng-template kendoTreeListEditTemplate let-dataItem="dataItem">
        <wbs-discipline-dropdown
          [data]="versionDisciplines"
          [values]="dataItem.disciplines"
          (save)="disciplinesChanged(treelist, dataItem.id, $event)"
        />
      </ng-template>
    </kendo-treelist-column>
    }
  </kendo-treelist>
  <kendo-contextmenu
    #contextMenu
    [items]="menu()"
    (select)="menuItemSelected($event.item.action)"
  >
    <ng-template kendoMenuItemTemplate let-item="item">
      <wbs-context-menu-item [item]="item" />
    </ng-template>
  </kendo-contextmenu>
</div>
}
<router-outlet />
